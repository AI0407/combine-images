(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(i){if(i.ep)return;i.ep=!0;const c=e(i);fetch(i.href,c)}})();const k="modulepreload",A=function(t){return"/"+t},D={},P=function(r,e,o){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),g=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(e.map(l=>{if(l=A(l),l in D)return;D[l]=!0;const d=l.endsWith(".css"),y=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${y}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":k,d||(f.as="script"),f.crossOrigin="",f.href=l,g&&f.setAttribute("nonce",g),document.head.appendChild(f),d)return new Promise((u,h)=>{f.addEventListener("load",u),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${l}`)))})}))}function c(a){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=a,window.dispatchEvent(g),!g.defaultPrevented)throw a}return i.then(a=>{for(const g of a||[])g.status==="rejected"&&c(g.reason);return r().catch(c)})},s={toast:document.getElementById("toast"),modeSwitcher:document.getElementById("mode-switcher"),layoutModeBtn:document.getElementById("layout-mode-btn"),stitchingModeBtn:document.getElementById("stitching-mode-btn"),layoutWrapper:document.getElementById("layout-wrapper"),layoutGrid:document.getElementById("layout-grid"),stitchingWrapper:document.getElementById("stitching-wrapper"),stitchingGrid:document.getElementById("stitching-grid"),layoutControls:document.getElementById("layout-controls"),stitchingControls:document.getElementById("stitching-controls"),layoutContainer:document.getElementById("layout-container"),stitchingDirectionBtns:document.getElementById("stitching-direction-btns"),stitchingUploadBtn:document.getElementById("stitching-upload-btn"),stitchingUploadInput:document.getElementById("stitching-upload-input"),canvasSettings:document.getElementById("canvas-settings"),aspectRatioBtns:document.getElementById("aspect-ratio-btns"),spacingSlider:document.getElementById("spacing-slider"),spacingValue:document.getElementById("spacing-value"),radiusSlider:document.getElementById("radius-slider"),radiusValue:document.getElementById("radius-value"),colorPicker:document.getElementById("color-picker"),shuffleBtn:document.getElementById("shuffle-btn"),downloadBtn:document.getElementById("download-btn")},m=(t,r)=>{const e=document.createElement(t);return r&&(e.className=r),e},T={upload:'<div class="upload-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm48-88a8,8,0,0,1-8,8H136v32a8,8,0,0,1-16,0V136H88a8,8,0,0,1,0-16h32V88a8,8,0,0,1,16,0v32h32A8,8,0,0,1,176,128Z"></path></svg></div>',remove:'<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>'},n={currentMode:"layout",currentLayoutId:"3-t1b2",imagesData:{},colFractions:[],rowFractions:[],stitchingImages:[],stitchingDirection:"horizontal"};function q(t){n.currentLayoutId=t}const B={"3-t1b2":{g:3,gr:[2,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"3-t2b1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"3-l1r2":{g:3,gr:[2,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"3-l2r1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"4-grid":{g:4,gr:[2,2]},"4-t1b3":{g:4,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-b1t3":{g:4,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"4-l1r3":{g:4,gr:[3,2],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-l-feat":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"4-r-feat":{g:4,gr:[2,3],c:[{r:1,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1,s:[2,1]}]},"4-121":{g:4,gr:[3,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"4-212":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"4-g3x2-alt":{g:4,gr:[3,2],c:[{r:2,c:1},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[1,2]},{r:2,c:1,s:[2,2]}]},"5-center":{g:5,gr:[3,3],c:[{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:2}]},"5-l3r2":{g:5,gr:[3,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"5-131":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1}]},"5-l2r3":{g:5,gr:[3,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t2b3":{g:5,gr:[2,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-center-h-bar":{g:5,gr:[3,2],c:[{r:1,c:1},{r:1,c:1,s:[1,2]},{r:1,c:2,s:[2,1]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-t2b3-split":{g:5,gr:[2,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"5-l1r4-col":{g:5,gr:[4,2],c:[{r:4,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t-feat-r":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t1b4-grid":{g:5,gr:[3,2],c:[{r:1,c:2},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-r1l4-col":{g:5,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:4,c:1,s:[1,2]}]},"5-cross-center":{g:5,gr:[3,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:3,s:[3,1]},{r:1,c:1,s:[2,2]}]},"5-l-tall-r-split":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:2},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:2,s:[3,2]}]},"5-213":{g:5,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-123":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"6-g3x2":{g:6,gr:[3,2]},"6-g2x3":{g:6,gr:[2,3]},"6-center":{g:6,gr:[4,4],c:[{r:1,c:3},{r:2,c:1},{r:3,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:2}]},"6-123":{g:6,gr:[3,6],c:[{r:1,c:6},{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"6-321":{g:6,gr:[3,6],c:[{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3},{r:1,c:6}]},"6-231":{g:6,gr:[3,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:6}]},"6-222":{g:6,gr:[3,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1}]},"6-1133":{g:6,gr:[4,3],c:[{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"6-223r":{g:6,gr:[3,3],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-223l":{g:6,gr:[3,3],c:[{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-114":{g:6,gr:[3,5],c:[{r:2,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-3333":{g:6,gr:[4,4],c:[{r:2,c:2},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:2}]},"7-h-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-w-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-l":{g:7,gr:[4,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-t":{g:7,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"7-311":{g:7,gr:[3,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-113":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"8-g4x2":{g:8,gr:[4,2]},"8-g2x4":{g:8,gr:[2,4]},"8-l2-tall-r6-grid":{g:8,gr:[3,4],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"8-sandwich-6":{g:8,gr:[4,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]},{r:1,c:1,s:[3,3]},{r:1,c:3,s:[4,1]}]},"8-313":{g:8,gr:[5,4],c:[{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:2,c:2}]},"8-131":{g:8,gr:[4,5],c:[{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"9-grid":{g:9,gr:[3,3]},"9-144-grid":{g:9,gr:[3,4],c:[{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-414-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-441-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4}]},"9-211-grid":{g:9,gr:[3,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-112-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"10-g5x2":{g:10,gr:[5,2]},"10-t2b8-grid":{g:10,gr:[3,4],c:[{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-424-grid":{g:10,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-t":{g:11,gr:[3,5],c:[{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-c":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-f":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5}]},"12-g4x3":{g:12,gr:[4,3]},"12-g3x4":{g:12,gr:[3,4]},"12-g6x6":{g:12,gr:[6,6],c:[{r:5,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-feat-c":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-211":{g:13,gr:[4,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-112":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"14-g7x2":{g:14,gr:[7,2]},"14-g4x4r":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"14-g4x4c":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g5x3":{g:15,gr:[5,3]},"15-g4x4c":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g4x4f":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"16-g4x4":{g:16,gr:[4,4]}};function v(t,r="success"){s.toast.textContent=t,s.toast.className="fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl translate-x-[120%] transition-transform duration-300";const e={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"};s.toast.classList.add(e[r]||"bg-gray-500"),s.toast.classList.remove("translate-x-[120%]"),setTimeout(()=>{s.toast.classList.add("translate-x-[120%]")},3e3)}function b(){const t=s.spacingSlider.value,r=s.radiusSlider.value,e=s.colorPicker.value;if(s.spacingValue.textContent=t,s.radiusValue.textContent=r,n.currentMode==="layout"){const o=s.layoutWrapper,i=s.layoutGrid;o.style.backgroundColor=e,i.style.padding=`${t}px`,i.style.gap=`${t}px`,i.querySelectorAll(".grid-cell").forEach(c=>{c.style.borderRadius=`${r}px`})}else{const o=s.stitchingWrapper,i=s.stitchingGrid;o.style.backgroundColor=e,o.style.padding=`${t}px`,i.style.gap=`${t}px`,i.querySelectorAll("img").forEach(c=>{c.style.borderRadius=`${r}px`})}}function w(t,r){const e=document.getElementById(t);e&&(e.style.backgroundImage=`url(${r})`,e.querySelector("label")&&(e.querySelector("label").innerHTML=""))}function R(t){const r=document.getElementById(t);r&&(r.style.backgroundImage="",r.querySelector("label")&&(r.querySelector("label").innerHTML=ICONS.upload))}function C(){let t=0;n.currentMode==="layout"?t=Object.keys(n.imagesData).length:t=n.stitchingImages.length,s.shuffleBtn.disabled=t<2}function F(t){if(t===n.currentMode)return;n.currentMode=t;const r=t==="layout";s.layoutControls.classList.toggle("hidden",!r),s.stitchingControls.classList.toggle("hidden",r),s.canvasSettings.classList.toggle("hidden",!r),s.layoutWrapper.classList.toggle("hidden",!r),s.stitchingWrapper.classList.toggle("hidden",r),s.layoutModeBtn.classList.toggle("active",r),s.stitchingModeBtn.classList.toggle("active",!r),C(),E()}function W(t){t!==n.stitchingDirection&&(n.stitchingDirection=t,document.querySelector("#stitching-direction-btns .active").classList.remove("active"),document.querySelector(`#stitching-direction-btns [data-direction="${t}"]`).classList.add("active"),E())}function O(t){var r,e;n.currentMode!=="layout"||t===n.currentLayoutId||((r=s.layoutContainer.querySelector(".active"))==null||r.classList.remove("active"),(e=s.layoutContainer.querySelector(`[data-layout="${t}"]`))==null||e.classList.add("active"),q(t),E())}function G(t){var e;if(n.currentMode!=="layout")return;(e=s.aspectRatioBtns.querySelector(".active"))==null||e.classList.remove("active"),t.classList.add("active");const r=t.dataset.ratio;s.layoutWrapper.style.aspectRatio=r,s.layoutWrapper.style.height="auto",s.layoutWrapper.style.minHeight="0",setTimeout(S,100)}function x(t){if(!t||t.length===0)return;const r=Array.from(t).filter(e=>e.type.startsWith("image/"));if(r.length===0){v("未选择有效的图片文件","error");return}if(n.currentMode==="layout"){const o=Array.from(document.querySelectorAll("#layout-grid .grid-cell")).map(a=>a.id).filter(a=>!n.imagesData[a]);if(o.length===0){v("没有空的格子可以放置图片","error");return}const i=Math.min(r.length,o.length);let c=0;for(let a=0;a<i;a++){const g=r[a],l=o[a],d=new FileReader;d.onload=y=>{if(n.imagesData[l]=y.target.result,w(l,y.target.result),c++,c===i){C();const f=`成功上传 ${i} 张图片。`+(r.length>i?` 已忽略 ${r.length-i} 张多余的图片。`:"");v(f,"success")}},d.readAsDataURL(g)}}else{const e=r.map(o=>new Promise(i=>{const c=new FileReader;c.onload=a=>i(a.target.result),c.readAsDataURL(o)}));Promise.all(e).then(o=>{n.stitchingImages=o,v(`成功选择 ${o.length} 张图片`,"success"),C(),E()})}}function U(){let t=0;if(n.currentMode==="layout"){const r=Object.entries(n.imagesData);if(t=r.length,t<2)return;const e=r.map(o=>o[1]);for(let o=e.length-1;o>0;o--){const i=Math.floor(Math.random()*(o+1));[e[o],e[i]]=[e[i],e[o]]}r.forEach(([o],i)=>{n.imagesData[o]=e[i],w(o,e[i])})}else{if(t=n.stitchingImages.length,t<2)return;for(let r=n.stitchingImages.length-1;r>0;r--){const e=Math.floor(Math.random()*(r+1));[n.stitchingImages[r],n.stitchingImages[e]]=[n.stitchingImages[e],n.stitchingImages[r]]}E()}t>1&&v("图片已随机排序","info")}function j(t,r){if(n.currentMode!=="layout"||!r)return;const e=n.imagesData[t],o=n.imagesData[r];n.imagesData[r]=e,w(r,e),o?(n.imagesData[t]=o,w(t,o)):(delete n.imagesData[t],R(t))}function H(t){n.currentMode==="layout"&&(delete n.imagesData[t],R(t),C())}function _(){const t=n.currentMode==="layout"?s.layoutGrid:s.stitchingGrid;t.querySelectorAll(".gutter").forEach(e=>e.style.display="none"),v("正在生成高清晰度图片...","info");const r={useCORS:!0,backgroundColor:s.colorPicker.value,scale:3,width:t.scrollWidth,height:t.scrollHeight};html2canvas(t,r).then(e=>{t.querySelectorAll(".gutter").forEach(i=>i.style.display="block");const o=m("a");o.download=`${n.currentMode}-collage-${Date.now()}.png`,o.href=e.toDataURL("image/png"),o.click(),v("图片已成功保存！","success")}).catch(e=>{console.error("截图失败:",e),v("截图失败，请重试","error"),t.querySelectorAll(".gutter").forEach(o=>o.style.display="block")})}function E(){b(),n.currentMode==="layout"?(s.layoutWrapper.classList.remove("hidden"),s.stitchingWrapper.classList.add("hidden"),N()):(s.layoutWrapper.classList.add("hidden"),s.stitchingWrapper.classList.remove("hidden"),z())}function N(){const t=s.layoutGrid;t.innerHTML="",Object.assign(t.style,{display:"grid",flexDirection:""});const r=B[n.currentLayoutId];if(!r)return;const[e,o]=r.gr;n.colFractions=Array(o).fill(1),n.rowFractions=Array(e).fill(1),t.style.gridTemplateRows=n.rowFractions.map(a=>`${a}fr`).join(" "),t.style.gridTemplateColumns=n.colFractions.map(a=>`${a}fr`).join(" ");const i=r.c||Array.from({length:e*o},()=>({r:1,c:1})),c={...n.imagesData};n.imagesData={},i.forEach((a,g)=>{const l=`cell-${g}`,d=V(l);d.style.gridRowEnd=`span ${a.r}`,d.style.gridColumnEnd=`span ${a.c}`,a.s&&(d.style.gridRowStart=a.s[0],d.style.gridColumnStart=a.s[1]),t.appendChild(d),c[l]&&(n.imagesData[l]=c[l],w(l,n.imagesData[l]))}),setTimeout(S,100)}function z(){const t=s.stitchingGrid;t.innerHTML="",t.className="collage-grid",t.classList.add(n.stitchingDirection),n.stitchingImages.forEach((r,e)=>{const o=m("img");o.src=r,o.dataset.index=e,o.style.borderRadius=`${s.radiusSlider.value}px`,t.appendChild(o)})}function V(t){const r=m("div","grid-cell");r.id=t,r.draggable=!0,r.addEventListener("dragstart",c=>{n.imagesData[t]?(c.dataTransfer.setData("text/plain",t),c.dataTransfer.effectAllowed="move",setTimeout(()=>c.target.classList.add("dragging"),0)):c.preventDefault()}),r.addEventListener("dragend",c=>c.target.classList.remove("dragging")),r.addEventListener("dragover",c=>{c.preventDefault(),c.currentTarget.classList.add("drag-over")}),r.addEventListener("dragleave",c=>c.currentTarget.classList.remove("drag-over")),r.addEventListener("drop",c=>{c.preventDefault(),c.currentTarget.classList.remove("drag-over");const a=c.dataTransfer.getData("text/plain");a?a!==c.currentTarget.id&&j(a,c.currentTarget.id):c.dataTransfer.files.length>0&&x(c.dataTransfer.files)});const e=m("input");e.type="file",e.accept="image/*",e.id=`input-${t}`,e.multiple=!0,e.onchange=c=>x(c.target.files);const o=m("label");o.htmlFor=`input-${t}`,o.className="w-full h-full flex items-center justify-center cursor-pointer",o.innerHTML=T.upload;const i=m("div","remove-image-btn");return i.innerHTML=T.remove,i.onclick=c=>{c.stopPropagation(),H(t)},r.append(o,e,i),r}function S(){const t=s.layoutGrid;if(t.querySelectorAll(".gutter").forEach(c=>c.remove()),n.currentMode!=="layout")return;const r=B[n.currentLayoutId];if(!r)return;const[e,o]=r.gr,i=t.getBoundingClientRect();if(o>1){const c=n.colFractions.map(g=>g/n.colFractions.reduce((l,d)=>l+d,0)*i.width);let a=0;for(let g=0;g<o-1;g++){a+=c[g];const l=m("div","gutter gutter-v");l.style.left=`${a}px`,l.style.height="100%",l.dataset.index=g,t.appendChild(l),$(l,"v")}}if(e>1){const c=n.rowFractions.map(g=>g/n.rowFractions.reduce((l,d)=>l+d,0)*i.height);let a=0;for(let g=0;g<e-1;g++){a+=c[g];const l=m("div","gutter gutter-h");l.style.top=`${a}px`,l.style.width="100%",l.dataset.index=g,t.appendChild(l),$(l,"h")}}}function $(t,r){t.onmousedown=function(e){e.preventDefault();const o=s.layoutGrid,i=parseInt(t.dataset.index),c=o.getBoundingClientRect(),a=function(l){if(r==="v"){const d=n.colFractions[i]+n.colFractions[i+1],y=n.colFractions.slice(0,i).reduce((p,L)=>p+L/n.colFractions.reduce((I,M)=>I+M,0)*c.width,0);let u=(l.clientX-c.left-y)/c.width*n.colFractions.reduce((p,L)=>p+L,0);u<.1&&(u=.1);let h=d-u;h<.1&&(h=.1,u=d-.1),n.colFractions[i]=u,n.colFractions[i+1]=h,o.style.gridTemplateColumns=n.colFractions.map(p=>`${p}fr`).join(" ")}else{const d=n.rowFractions[i]+n.rowFractions[i+1],y=n.rowFractions.slice(0,i).reduce((p,L)=>p+L/n.rowFractions.reduce((I,M)=>I+M,0)*c.height,0);let u=(l.clientY-c.top-y)/c.height*n.rowFractions.reduce((p,L)=>p+L,0);u<.1&&(u=.1);let h=d-u;h<.1&&(h=.1,u=d-.1),n.rowFractions[i]=u,n.rowFractions[i+1]=h,o.style.gridTemplateRows=n.rowFractions.map(p=>`${p}fr`).join(" ")}},g=function(){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",g),setTimeout(S,50)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",g)}}const Z=Object.freeze(Object.defineProperty({__proto__:null,createGutters:S,renderCanvas:E},Symbol.toStringTag,{value:"Module"}));(function(){const t="img.ops-coffee.cn",r=window.location.hostname;r&&r!==t&&r!=="localhost"&&r!=="12.0.0.1"&&(window.location.href=`https://${t}`)})();function K(){s.layoutContainer.innerHTML="";const t={};for(const r in B){const e=B[r];t[e.g]||(t[e.g]=[]),t[e.g].push({id:r,...e})}Object.keys(t).sort((r,e)=>r-e).forEach(r=>{const e=m("h4","layout-group-title");e.textContent=`${r} 张图片`,s.layoutContainer.appendChild(e);const o=m("div","layout-thumbnail-grid");t[r].forEach(i=>{const c=X(i.id,i);i.id===n.currentLayoutId&&c.classList.add("active"),o.appendChild(c)}),s.layoutContainer.appendChild(o)})}function X(t,r){const e=m("div","layout-thumbnail");e.dataset.layout=t;const o=m("div","thumbnail-grid");return o.style.gridTemplateColumns=`repeat(${r.gr[1]}, 1fr)`,o.style.gridTemplateRows=`repeat(${r.gr[0]}, 1fr)`,(r.c||Array.from({length:r.gr[0]*r.gr[1]},()=>({r:1,c:1}))).forEach(c=>{const a=m("div","thumbnail-cell");a.style.gridRowEnd=`span ${c.r}`,a.style.gridColumnEnd=`span ${c.c}`,c.s&&(a.style.gridRowStart=c.s[0],a.style.gridColumnStart=c.s[1]),o.appendChild(a)}),e.appendChild(o),e}function Y(){s.layoutModeBtn.addEventListener("click",()=>F("layout")),s.stitchingModeBtn.addEventListener("click",()=>F("stitching")),s.stitchingUploadBtn.addEventListener("click",()=>s.stitchingUploadInput.click()),s.stitchingUploadInput.addEventListener("change",r=>x(r.target.files)),s.stitchingDirectionBtns.addEventListener("click",r=>{const e=r.target.closest("button");e&&W(e.dataset.direction)}),s.stitchingUploadBtn.addEventListener("dragover",r=>r.preventDefault()),s.stitchingUploadBtn.addEventListener("drop",r=>{r.preventDefault(),x(r.dataTransfer.files)}),s.layoutContainer.addEventListener("click",r=>{const e=r.target.closest(".layout-thumbnail");e&&O(e.dataset.layout)}),s.aspectRatioBtns.addEventListener("click",r=>{const e=r.target.closest("button");e&&G(e)}),s.spacingSlider.addEventListener("input",b),s.radiusSlider.addEventListener("input",b),s.colorPicker.addEventListener("input",b),s.shuffleBtn.addEventListener("click",U),s.downloadBtn.addEventListener("click",_);let t;window.addEventListener("resize",()=>{clearTimeout(t),n.currentMode==="layout"&&(t=setTimeout(()=>{P(async()=>{const{createGutters:r}=await Promise.resolve().then(()=>Z);return{createGutters:r}},void 0).then(({createGutters:r})=>{r()})},150))})}function J(){K(),Y(),s.layoutModeBtn.classList.add("active"),s.stitchingModeBtn.classList.remove("active"),s.layoutControls.classList.remove("hidden"),s.stitchingControls.classList.add("hidden"),s.canvasSettings.classList.remove("hidden");const t=s.aspectRatioBtns.querySelector('[data-ratio="1/1"]');t&&(t.classList.add("active"),s.layoutWrapper.style.aspectRatio="1/1"),E(),console.log("%c 免费在线拼图工具 %c by ops-coffee.cn ","background: #0052cc; color: #fff; padding: 5px; border-radius: 5px 0 0 5px;","background: #f4f5f7; color: #42526e; padding: 5px; border-radius: 0 5px 5px 0;"),console.log("感谢使用！如果您对这个工具有任何建议，欢迎联系我们。微信公众号搜索：运维咖啡吧")}document.addEventListener("DOMContentLoaded",J);
